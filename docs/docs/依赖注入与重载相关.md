# 为什么在Nonebot2的开发中，类型注解如此重要

首先抛开类型注解自身对于开发的便利性不谈，单说`Nonebot2`中类型注解的特殊性。

在`Nonebot2`中，类型注解在整个事件处理流程中，包括进行依赖注入以及事件重载还有配置项的编写已经实例化都具有相当的作用，没有适当的类型注解，以上功能就无法工作，导致整个事件处理器瘫痪。

# 什么是依赖注入以及Nonebot2预置什么依赖注入

[nonebot2 - 依赖注入](https://nonebot.dev/docs/advanced/dependency)

简而言之就是将要运行的函数的参数默认值改为一个依赖函数，使用依赖函数的返回值作为要运行的函数的参数的默认值

这种方法可以提高代码的复用能力，使代码更加简洁可读

## Nonebot2的依赖注入是什么

> 在了解如何使用依赖注入获取上下文信息之前，我们需要先了解两个概念：
> 
> `Dependent`：使用依赖注入的函数或其他任意可调用对象。如：事件处理函数、自定义的依赖函数等。
`Dependency`：依赖注入的对象。如：当前事件、机器人等。
在之前的文档中，我们已经多次使用了依赖注入来获取事件信息。通过对函数参数依照一定规则填写类型注解，即可获得想要的上下文信息。任何一个事件处理函数在添加到事件处理流程时，都会根据一定规则提前将其解析成一个 `Dependent` 对象，方便运行时进行注入。如果遇到无法解析的参数，将会抛出 `ValueError("Unknown parameter")` 的异常。整个依赖注入系统可以分为两部分：
> 
> - 参数解析
>   - 依据一定规则解析函数参数，识别 `Dependency` 依赖。
>   - 生成 `Dependent` 对象。
> - 执行
>   - 根据已经解析的 `Dependency` 依赖，执行调用。
>   - 将所有 `Dependency` 的返回值根据参数名传入并调用 `Dependent` 。

如nonebot2的文档所说，是在事件处理过程中为函数提供的参数。

由于没有更加详细的原理解释以及编写自定义`Dependent`类的文档，所以不推荐自己去编写自定义`Dependent`类。

所有由`nonebot2`提供的依赖注入的类以及会被解析的参数与类型都在本文开头的链接里提供。

# 在Nonebot2中什么是重载

[Nonebot2 - 事件类型与重载 #重载](https://nonebot.dev/docs/appendices/overload#%E9%87%8D%E8%BD%BD)

> 简单来说，依赖函数会根据其参数的类型注解来决定是否执行，忽略不符合其参数类型注解的情况。

重载可以实现事件处理器的选择以实现跨平台支持以及消息类型的筛选，而不必我们自己去编写代码来进行判断

在`Nonebot2`中时间重载的具体写法为在函数中为参数添加类型注解，`Nonebot2`在进行依赖注入的时候会自动进行重载。

> Bot、Event 和 Matcher 三者的参数类型注解具有最高检查优先级，如果三者任一类型注解不匹配，那么其他依赖注入将不会执行（如：`Depends`）。

例子看本节开头的链接，里边已经包含了一个很好的示例
